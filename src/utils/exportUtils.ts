// Utility functions for exporting data in various formats

export function exportToJSON(data: any, filename: string) {
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  downloadBlob(blob, `${filename}.json`);
}

export function exportToCSV(data: any[], filename: string, language: string = 'en-US') {
  if (data.length === 0) return;
  
  // Get translation for headers
  const translateHeader = (key: string): string => {
    const translations: Record<string, Record<string, string>> = {
      'en-US': {
        id: 'ID',
        name: 'Name',
        category: 'Category',
        price: 'Price',
        stock: 'Stock',
        status: 'Status',
        sales: 'Sales',
        email: 'Email',
        phone: 'Phone',
        role: 'Role',
        fullName: 'Full Name',
        contact: 'Contact',
        image: 'Image',
      },
      'es-ES': {
        id: 'ID',
        name: 'Nombre',
        category: 'Categor√≠a',
        price: 'Precio',
        stock: 'Existencias',
        status: 'Estado',
        sales: 'Ventas',
        email: 'Correo',
        phone: 'Tel√©fono',
        role: 'Rol',
        fullName: 'Nombre Completo',
        contact: 'Contacto',
        image: 'Imagen',
      },
      'fr-FR': {
        id: 'ID',
        name: 'Nom',
        category: 'Cat√©gorie',
        price: 'Prix',
        stock: 'Stock',
        status: 'Statut',
        sales: 'Ventes',
        email: 'Email',
        phone: 'T√©l√©phone',
        role: 'R√¥le',
        fullName: 'Nom Complet',
        contact: 'Contact',
        image: 'Image',
      },
      'de-DE': {
        id: 'ID',
        name: 'Name',
        category: 'Kategorie',
        price: 'Preis',
        stock: 'Lagerbestand',
        status: 'Status',
        sales: 'Verk√§ufe',
        email: 'E-Mail',
        phone: 'Telefon',
        role: 'Rolle',
        fullName: 'Vollst√§ndiger Name',
        contact: 'Kontakt',
        image: 'Bild',
      },
      'pt-BR': {
        id: 'ID',
        name: 'Nome',
        category: 'Categoria',
        price: 'Pre√ßo',
        stock: 'Estoque',
        status: 'Status',
        sales: 'Vendas',
        email: 'Email',
        phone: 'Telefone',
        role: 'Fun√ß√£o',
        fullName: 'Nome Completo',
        contact: 'Contato',
        image: 'Imagem',
      },
      'ja-JP': {
        id: 'ID',
        name: 'ÂêçÂâç',
        category: '„Ç´„ÉÜ„Ç¥„É™',
        price: '‰æ°Ê†º',
        stock: 'Âú®Â∫´',
        status: '„Çπ„ÉÜ„Éº„Çø„Çπ',
        sales: 'Â£≤‰∏ä',
        email: '„É°„Éº„É´',
        phone: 'ÈõªË©±',
        role: 'ÂΩπÂâ≤',
        fullName: '„Éï„É´„Éç„Éº„É†',
        contact: 'ÈÄ£Áµ°ÂÖà',
        image: 'ÁîªÂÉè',
      },
      'zh-CN': {
        id: 'ID',
        name: 'ÂêçÁß∞',
        category: 'Á±ªÂà´',
        price: '‰ª∑Ê†º',
        stock: 'Â∫ìÂ≠ò',
        status: 'Áä∂ÊÄÅ',
        sales: 'ÈîÄÂîÆ',
        email: 'ÁîµÂ≠êÈÇÆ‰ª∂',
        phone: 'ÁîµËØù',
        role: 'ËßíËâ≤',
        fullName: 'ÂÖ®Âêç',
        contact: 'ËÅîÁ≥ªÊñπÂºè',
        image: 'ÂõæÁâá',
      },
    };
    
    const langCode = language.startsWith('en') ? 'en-US' :
                     language.startsWith('es') ? 'es-ES' :
                     language.startsWith('fr') ? 'fr-FR' :
                     language.startsWith('de') ? 'de-DE' :
                     language.startsWith('pt') ? 'pt-BR' :
                     language.startsWith('ja') ? 'ja-JP' :
                     language.startsWith('zh') ? 'zh-CN' : 'en-US';
    
    return translations[langCode][key] || key.charAt(0).toUpperCase() + key.slice(1);
  };
  
  const headers = Object.keys(data[0]);
  const translatedHeaders = headers.map(h => translateHeader(h));
  
  const csvContent = [
    translatedHeaders.join(','),
    ...data.map(row => 
      headers.map(header => {
        const value = row[header];
        // Escape commas and quotes
        if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
          return `"${value.replace(/"/g, '""')}"`;
        }
        return value ?? '';
      }).join(',')
    )
  ].join('\n');
  
  // Add BOM for Excel UTF-8 support
  const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
  downloadBlob(blob, `${filename}.csv`);
}

export function exportToText(data: any, filename: string, title: string, language: string = 'en-US') {
  const getLocalizedText = (key: string): string => {
    const texts: Record<string, Record<string, string>> = {
      'en-US': {
        exportDate: 'Export Date',
        generatedBy: 'Generated by Dashboard System',
        item: 'Item',
        summary: 'Summary',
        details: 'Details',
        profile: 'Profile Settings',
        notifications: 'Notification Preferences',
        theme: 'Theme & Appearance',
        appearance: 'Appearance',
        language: 'Language & Region',
        name: 'Name',
        email: 'Email',
        phone: 'Phone',
        bio: 'Bio',
        company: 'Company',
        website: 'Website',
        location: 'Location',
        timezone: 'Timezone',
        darkMode: 'Dark Mode',
        compactMode: 'Compact Mode',
        animations: 'Animations',
        fontSize: 'Font Size',
        colorScheme: 'Color Scheme',
        dateFormat: 'Date Format',
        timeFormat: 'Time Format',
        currency: 'Currency',
        push: 'Push Notifications',
        weeklyReport: 'Weekly Report',
        productUpdates: 'Product Updates',
        securityAlerts: 'Security Alerts',
        totalRevenue: 'Total Revenue',
        totalOrders: 'Total Orders',
        activeUsers: 'Active Users',
        totalProducts: 'Total Products',
        stats: 'Statistics',
        title: 'Title',
        value: 'Value',
        change: 'Change',
      },
      'es-ES': {
        exportDate: 'Fecha de Exportaci√≥n',
        generatedBy: 'Generado por Sistema Dashboard',
        item: 'Art√≠culo',
        summary: 'Resumen',
        details: 'Detalles',
        profile: 'Configuraci√≥n del Perfil',
        notifications: 'Preferencias de Notificaciones',
        theme: 'Tema y Apariencia',
        appearance: 'Apariencia',
        language: 'Idioma y Regi√≥n',
        name: 'Nombre',
        email: 'Correo Electr√≥nico',
        phone: 'Tel√©fono',
        bio: 'Biograf√≠a',
        company: 'Empresa',
        website: 'Sitio Web',
        location: 'Ubicaci√≥n',
        timezone: 'Zona Horaria',
        darkMode: 'Modo Oscuro',
        compactMode: 'Modo Compacto',
        animations: 'Animaciones',
        fontSize: 'Tama√±o de Fuente',
        colorScheme: 'Esquema de Color',
        dateFormat: 'Formato de Fecha',
        timeFormat: 'Formato de Hora',
        currency: 'Moneda',
        push: 'Notificaciones Push',
        weeklyReport: 'Reporte Semanal',
        productUpdates: 'Actualizaciones de Producto',
        securityAlerts: 'Alertas de Seguridad',
        totalRevenue: 'Ingresos Totales',
        totalOrders: 'Pedidos Totales',
        activeUsers: 'Usuarios Activos',
        totalProducts: 'Productos Totales',
        stats: 'Estad√≠sticas',
        title: 'T√≠tulo',
        value: 'Valor',
        change: 'Cambio',
      },
      'fr-FR': {
        exportDate: 'Date d\'Exportation',
        generatedBy: 'G√©n√©r√© par Syst√®me Dashboard',
        item: 'Article',
        summary: 'R√©sum√©',
        details: 'D√©tails',
        profile: 'Param√®tres du Profil',
        notifications: 'Pr√©f√©rences de Notification',
        theme: 'Th√®me et Apparence',
        appearance: 'Apparence',
        language: 'Langue et R√©gion',
        name: 'Nom',
        email: 'Email',
        phone: 'T√©l√©phone',
        bio: 'Biographie',
        company: 'Entreprise',
        website: 'Site Web',
        location: 'Emplacement',
        timezone: 'Fuseau Horaire',
        darkMode: 'Mode Sombre',
        compactMode: 'Mode Compact',
        animations: 'Animations',
        fontSize: 'Taille de Police',
        colorScheme: 'Sch√©ma de Couleurs',
        dateFormat: 'Format de Date',
        timeFormat: 'Format d\'Heure',
        currency: 'Devise',
        push: 'Notifications Push',
        weeklyReport: 'Rapport Hebdomadaire',
        productUpdates: 'Mises √† Jour Produit',
        securityAlerts: 'Alertes de S√©curit√©',
        totalRevenue: 'Revenu Total',
        totalOrders: 'Commandes Totales',
        activeUsers: 'Utilisateurs Actifs',
        totalProducts: 'Produits Totaux',
        stats: 'Statistiques',
        title: 'Titre',
        value: 'Valeur',
        change: 'Changement',
      },
      'de-DE': {
        exportDate: 'Exportdatum',
        generatedBy: 'Generiert vom Dashboard-System',
        item: 'Artikel',
        summary: 'Zusammenfassung',
        details: 'Details',
        profile: 'Profileinstellungen',
        notifications: 'Benachrichtigungseinstellungen',
        theme: 'Design und Erscheinungsbild',
        appearance: 'Erscheinungsbild',
        language: 'Sprache und Region',
        name: 'Name',
        email: 'E-Mail',
        phone: 'Telefon',
        bio: 'Biografie',
        company: 'Unternehmen',
        website: 'Webseite',
        location: 'Standort',
        timezone: 'Zeitzone',
        darkMode: 'Dunkler Modus',
        compactMode: 'Kompaktmodus',
        animations: 'Animationen',
        fontSize: 'Schriftgr√∂√üe',
        colorScheme: 'Farbschema',
        dateFormat: 'Datumsformat',
        timeFormat: 'Zeitformat',
        currency: 'W√§hrung',
        push: 'Push-Benachrichtigungen',
        weeklyReport: 'W√∂chentlicher Bericht',
        productUpdates: 'Produktaktualisierungen',
        securityAlerts: 'Sicherheitswarnungen',
        totalRevenue: 'Gesamtumsatz',
        totalOrders: 'Gesamtbestellungen',
        activeUsers: 'Aktive Benutzer',
        totalProducts: 'Gesamtprodukte',
        stats: 'Statistiken',
        title: 'Titel',
        value: 'Wert',
        change: '√Ñnderung',
      },
      'pt-BR': {
        exportDate: 'Data de Exporta√ß√£o',
        generatedBy: 'Gerado pelo Sistema Dashboard',
        item: 'Item',
        summary: 'Resumo',
        details: 'Detalhes',
        profile: 'Configura√ß√µes de Perfil',
        notifications: 'Prefer√™ncias de Notifica√ß√µes',
        theme: 'Tema e Apar√™ncia',
        appearance: 'Apar√™ncia',
        language: 'Idioma e Regi√£o',
        name: 'Nome',
        email: 'Email',
        phone: 'Telefone',
        bio: 'Biografia',
        company: 'Empresa',
        website: 'Site',
        location: 'Localiza√ß√£o',
        timezone: 'Fuso Hor√°rio',
        darkMode: 'Modo Escuro',
        compactMode: 'Modo Compacto',
        animations: 'Anima√ß√µes',
        fontSize: 'Tamanho da Fonte',
        colorScheme: 'Esquema de Cores',
        dateFormat: 'Formato de Data',
        timeFormat: 'Formato de Hora',
        currency: 'Moeda',
        push: 'Notifica√ß√µes Push',
        weeklyReport: 'Relat√≥rio Semanal',
        productUpdates: 'Atualiza√ß√µes de Produto',
        securityAlerts: 'Alertas de Seguran√ßa',
        totalRevenue: 'Receita Total',
        totalOrders: 'Pedidos Totais',
        activeUsers: 'Usu√°rios Ativos',
        totalProducts: 'Produtos Totais',
        stats: 'Estat√≠sticas',
        title: 'T√≠tulo',
        value: 'Valor',
        change: 'Mudan√ßa',
      },
      'ja-JP': {
        exportDate: '„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊó•',
        generatedBy: '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Ç∑„Çπ„ÉÜ„É†„ÅßÁîüÊàê',
        item: '„Ç¢„Ç§„ÉÜ„É†',
        summary: 'Ê¶ÇË¶Å',
        details: 'Ë©≥Á¥∞',
        profile: '„Éó„É≠„Éï„Ç£„Éº„É´Ë®≠ÂÆö',
        notifications: 'ÈÄöÁü•Ë®≠ÂÆö',
        theme: '„ÉÜ„Éº„Éû„Å®Â§ñË¶≥',
        appearance: 'Â§ñË¶≥',
        language: 'Ë®ÄË™û„Å®Âú∞Âüü',
        name: 'ÂêçÂâç',
        email: '„É°„Éº„É´',
        phone: 'ÈõªË©±',
        bio: 'Ëá™Â∑±Á¥π‰ªã',
        company: '‰ºöÁ§æ',
        website: '„Ç¶„Çß„Éñ„Çµ„Ç§„Éà',
        location: 'Â†¥ÊâÄ',
        timezone: '„Çø„Ç§„É†„Çæ„Éº„É≥',
        darkMode: '„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ',
        compactMode: '„Ç≥„É≥„Éë„ÇØ„Éà„É¢„Éº„Éâ',
        animations: '„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥',
        fontSize: '„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫',
        colorScheme: '„Ç´„É©„Éº„Çπ„Ç≠„Éº„É†',
        dateFormat: 'Êó•‰ªòÂΩ¢Âºè',
        timeFormat: 'ÊôÇÂàªÂΩ¢Âºè',
        currency: 'ÈÄöË≤®',
        push: 'ÔøΩÔøΩ„ÉÉ„Ç∑„É•ÈÄöÁü•',
        weeklyReport: 'ÈÄ±Ê¨°„É¨„Éù„Éº„Éà',
        productUpdates: 'Ë£ΩÂìÅ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà',
        securityAlerts: '„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç¢„É©„Éº„Éà',
      },
      'zh-CN': {
        exportDate: 'ÂØºÂá∫Êó•Êúü',
        generatedBy: 'Áî±‰ª™Ë°®ÊùøÁ≥ªÁªüÁîüÊàê',
        item: 'È°πÁõÆ',
        summary: 'ÊëòË¶Å',
        details: 'ËØ¶ÊÉÖ',
        profile: '‰∏™‰∫∫ËµÑÊñôËÆæÁΩÆ',
        notifications: 'ÈÄöÁü•ÂÅèÂ•Ω',
        theme: '‰∏ªÈ¢òÂíåÂ§ñËßÇ',
        appearance: 'Â§ñËßÇ',
        language: 'ËØ≠Ë®ÄÂíåÂú∞Âå∫',
        name: 'ÂêçÁß∞',
        email: 'ÁîµÂ≠êÈÇÆ‰ª∂',
        phone: 'ÁîµËØù',
        bio: 'ÁÆÄ‰ªã',
        company: 'ÂÖ¨Âè∏',
        website: 'ÁΩëÁ´ô',
        location: '‰ΩçÁΩÆ',
        timezone: 'Êó∂Âå∫',
        darkMode: 'Ê∑±Ëâ≤Ê®°Âºè',
        compactMode: 'Á¥ßÂáëÊ®°Âºè',
        animations: 'Âä®Áîª',
        fontSize: 'Â≠ó‰ΩìÂ§ßÂ∞è',
        colorScheme: 'ÈÖçËâ≤ÊñπÊ°à',
        dateFormat: 'Êó•ÊúüÊ†ºÂºè',
        timeFormat: 'Êó∂Èó¥Ê†ºÂºè',
        currency: 'Ë¥ßÂ∏Å',
        push: 'Êé®ÈÄÅÈÄöÁü•',
        weeklyReport: 'ÊØèÂë®Êä•Âëä',
        productUpdates: '‰∫ßÂìÅÊõ¥Êñ∞',
        securityAlerts: 'ÂÆâÂÖ®Ë≠¶Êä•',
        totalRevenue: 'ÊÄªÊî∂ÂÖ•',
        totalOrders: 'ÊÄªËÆ¢Âçï',
        activeUsers: 'Ê¥ªË∑ÉÁî®Êà∑',
        totalProducts: 'ÊÄª‰∫ßÂìÅ',
        stats: 'ÁªüËÆ°',
        title: 'Ê†áÈ¢ò',
        value: 'ÂÄº',
        change: 'ÂèòÂåñ',
      },
    };
    
    const langCode = language.startsWith('en') ? 'en-US' :
                     language.startsWith('es') ? 'es-ES' :
                     language.startsWith('fr') ? 'fr-FR' :
                     language.startsWith('de') ? 'de-DE' :
                     language.startsWith('pt') ? 'pt-BR' :
                     language.startsWith('ja') ? 'ja-JP' :
                     language.startsWith('zh') ? 'zh-CN' : 'en-US';
    
    return texts[langCode][key] || key;
  };

  const getSectionEmoji = (key: string): string => {
    const emojiMap: Record<string, string> = {
      profile: 'üë§',
      notifications: 'üîî',
      theme: 'üé®',
      appearance: '‚ú®',
      language: 'üåê',
      dateFormat: 'üìÖ',
      timeFormat: '‚è∞',
      currency: 'üí∞',
    };
    return emojiMap[key] || 'üìã';
  };

  const getFieldEmoji = (key: string): string => {
    const emojiMap: Record<string, string> = {
      name: 'üë§',
      email: 'üìß',
      phone: 'üì±',
      bio: 'üìù',
      company: 'üè¢',
      website: 'üåê',
      location: 'üìç',
      timezone: 'üåç',
      darkMode: 'üåô',
      compactMode: 'üìê',
      animations: '‚ú®',
      fontSize: 'üî§',
      colorScheme: 'üé®',
      push: 'üì≤',
      weeklyReport: 'üìä',
      productUpdates: 'üÜï',
      securityAlerts: 'üîí',
    };
    return emojiMap[key] || '‚Ä¢';
  };

  const formatBoolean = (value: any): string => {
    return value ? '‚úÖ' : '‚ùå';
  };
  
  let textContent = '';
  
  // Header elegante
  textContent += '\n\n';
  textContent += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  textContent += '                                                                   \n';
  textContent += `                     üìÑ  ${title.toUpperCase()}                    \n`;
  textContent += '                                                                   \n';
  textContent += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
  
  // Info de exportaci√≥n
  textContent += `  üìÖ  ${getLocalizedText('exportDate')}\n`;
  textContent += `      ${new Date().toLocaleString(language, { dateStyle: 'full', timeStyle: 'short' })}\n\n`;
  textContent += `  ‚öôÔ∏è   ${getLocalizedText('generatedBy')}\n\n`;
  textContent += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';
  
  if (Array.isArray(data)) {
    data.forEach((item, index) => {
      textContent += `\n  ‚ñ†  ${getLocalizedText('item')} ${index + 1}\n`;
      textContent += '     ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ\n\n';
      Object.entries(item).forEach(([key, value]) => {
        if (key !== 'image') {
          const translatedKey = getLocalizedText(key);
          const displayKey = translatedKey || (key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1'));
          textContent += `     ${getFieldEmoji(key)}  ${displayKey.padEnd(18)}: ${value}\n`;
        }
      });
      textContent += '\n';
    });
  } else {
    Object.entries(data).forEach(([key, value]) => {
      if (Array.isArray(value) && key === 'stats') {
        textContent += `\n  üìä  ${getLocalizedText('stats').toUpperCase()}\n`;
        textContent += '  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n';
        value.forEach((stat: any, index: number) => {
          textContent += `     ${index + 1}. ${stat.title}\n`;
          textContent += `        ${getLocalizedText('value')}: ${stat.value}\n`;
          if (stat.change) {
            textContent += `        ${getLocalizedText('change')}: ${stat.change}\n`;
          }
          textContent += '\n';
        });
      } else if (typeof value === 'object' && value !== null && !key.includes('Date') && !Array.isArray(value)) {
        textContent += `\n  ${getSectionEmoji(key)}  ${getLocalizedText(key).toUpperCase()}\n`;
        textContent += '  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n';
        Object.entries(value as object).forEach(([k, v]) => {
          const translatedKey = getLocalizedText(k);
          const displayValue = typeof v === 'boolean' ? formatBoolean(v) : v;
          textContent += `     ${getFieldEmoji(k)}  ${translatedKey.padEnd(28)} ${displayValue}\n`;
        });
        textContent += '\n';
      } else if (!key.includes('Date') && key !== 'stats') {
        const translatedKey = getLocalizedText(key);
        const displayValue = typeof value === 'boolean' ? formatBoolean(value) : value;
        textContent += `  ${getFieldEmoji(key)}  ${translatedKey.padEnd(30)} ${displayValue}\n`;
      }
    });
  }
  
  // Footer elegante
  textContent += '\n\n';
  textContent += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  textContent += `                  ‚ú®  ${getLocalizedText('generatedBy')}\n`;
  textContent += `                  üìÜ  ${new Date().toLocaleDateString(language, { dateStyle: 'long' })}\n`;
  textContent += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
  
  const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8;' });
  downloadBlob(blob, `${filename}.txt`);
}

export function exportToPDF(data: any, filename: string, title: string, language: string = 'en-US') {
  const getLocalizedText = (key: string): string => {
    const texts: Record<string, Record<string, string>> = {
      'en-US': {
        exportDate: 'Export Date',
        generatedBy: 'Generated by Dashboard System',
        totalRecords: 'Total Records',
        summary: 'Summary',
        page: 'Page',
        profile: 'Profile Settings',
        notifications: 'Notification Preferences',
        theme: 'Theme & Appearance',
        appearance: 'Appearance',
        language: 'Language & Region',
        name: 'Name',
        email: 'Email',
        phone: 'Phone',
        bio: 'Bio',
        company: 'Company',
        website: 'Website',
        location: 'Location',
        timezone: 'Timezone',
        darkMode: 'Dark Mode',
        compactMode: 'Compact Mode',
        animations: 'Animations',
        fontSize: 'Font Size',
        colorScheme: 'Color Scheme',
        dateFormat: 'Date Format',
        timeFormat: 'Time Format',
        currency: 'Currency',
        push: 'Push Notifications',
        weeklyReport: 'Weekly Report',
        productUpdates: 'Product Updates',
        securityAlerts: 'Security Alerts',
        totalRevenue: 'Total Revenue',
        totalOrders: 'Total Orders',
        activeUsers: 'Active Users',
        totalProducts: 'Total Products',
        stats: 'Statistics',
      },
      'es-ES': {
        exportDate: 'Fecha de Exportaci√≥n',
        generatedBy: 'Generado por Sistema Dashboard',
        totalRecords: 'Total de Registros',
        summary: 'Resumen',
        page: 'P√°gina',
        profile: 'Configuraci√≥n del Perfil',
        notifications: 'Preferencias de Notificaciones',
        theme: 'Tema y Apariencia',
        appearance: 'Apariencia',
        language: 'Idioma y Regi√≥n',
        name: 'Nombre',
        email: 'Correo Electr√≥nico',
        phone: 'Tel√©fono',
        bio: 'Biograf√≠a',
        company: 'Empresa',
        website: 'Sitio Web',
        location: 'Ubicaci√≥n',
        timezone: 'Zona Horaria',
        darkMode: 'Modo Oscuro',
        compactMode: 'Modo Compacto',
        animations: 'Animaciones',
        fontSize: 'Tama√±o de Fuente',
        colorScheme: 'Esquema de Color',
        dateFormat: 'Formato de Fecha',
        timeFormat: 'Formato de Hora',
        currency: 'Moneda',
        push: 'Notificaciones Push',
        weeklyReport: 'Reporte Semanal',
        productUpdates: 'Actualizaciones de Producto',
        securityAlerts: 'Alertas de Seguridad',
        totalRevenue: 'Ingresos Totales',
        totalOrders: 'Pedidos Totales',
        activeUsers: 'Usuarios Activos',
        totalProducts: 'Productos Totales',
        stats: 'Estad√≠sticas',
      },
      'fr-FR': {
        exportDate: 'Date d\'Exportation',
        generatedBy: 'G√©n√©r√© par Syst√®me Dashboard',
        totalRecords: 'Total des Enregistrements',
        summary: 'R√©sum√©',
        page: 'Page',
        profile: 'Param√®tres du Profil',
        notifications: 'Pr√©f√©rences de Notification',
        theme: 'Th√®me et Apparence',
        appearance: 'Apparence',
        language: 'Langue et R√©gion',
        name: 'Nom',
        email: 'Email',
        phone: 'T√©l√©phone',
        bio: 'Biographie',
        company: 'Entreprise',
        website: 'Site Web',
        location: 'Emplacement',
        timezone: 'Fuseau Horaire',
        darkMode: 'Mode Sombre',
        compactMode: 'Mode Compact',
        animations: 'Animations',
        fontSize: 'Taille de Police',
        colorScheme: 'Sch√©ma de Couleurs',
        dateFormat: 'Format de Date',
        timeFormat: 'Format d\'Heure',
        currency: 'Devise',
        push: 'Notifications Push',
        weeklyReport: 'Rapport Hebdomadaire',
        productUpdates: 'Mises √† Jour Produit',
        securityAlerts: 'Alertes de S√©curit√©',
        totalRevenue: 'Revenu Total',
        totalOrders: 'Commandes Totales',
        activeUsers: 'Utilisateurs Actifs',
        totalProducts: 'Produits Totaux',
        stats: 'Statistiques',
      },
      'de-DE': {
        exportDate: 'Exportdatum',
        generatedBy: 'Generiert vom Dashboard-System',
        totalRecords: 'Gesamtanzahl',
        summary: 'Zusammenfassung',
        page: 'Seite',
        profile: 'Profileinstellungen',
        notifications: 'Benachrichtigungseinstellungen',
        theme: 'Design und Erscheinungsbild',
        appearance: 'Erscheinungsbild',
        language: 'Sprache und Region',
        name: 'Name',
        email: 'E-Mail',
        phone: 'Telefon',
        bio: 'Biografie',
        company: 'Unternehmen',
        website: 'Webseite',
        location: 'Standort',
        timezone: 'Zeitzone',
        darkMode: 'Dunkler Modus',
        compactMode: 'Kompaktmodus',
        animations: 'Animationen',
        fontSize: 'Schriftgr√∂√üe',
        colorScheme: 'Farbschema',
        dateFormat: 'Datumsformat',
        timeFormat: 'Zeitformat',
        currency: 'W√§hrung',
        push: 'Push-Benachrichtigungen',
        weeklyReport: 'W√∂chentlicher Bericht',
        productUpdates: 'Produktaktualisierungen',
        securityAlerts: 'Sicherheitswarnungen',
        totalRevenue: 'Gesamtumsatz',
        totalOrders: 'Gesamtbestellungen',
        activeUsers: 'Aktive Benutzer',
        totalProducts: 'Gesamtprodukte',
        stats: 'Statistiken',
      },
      'pt-BR': {
        exportDate: 'Data de Exporta√ß√£o',
        generatedBy: 'Gerado pelo Sistema Dashboard',
        totalRecords: 'Total de Registros',
        summary: 'Resumo',
        page: 'P√°gina',
        profile: 'Configura√ß√µes de Perfil',
        notifications: 'Prefer√™ncias de Notifica√ß√µes',
        theme: 'Tema e Apar√™ncia',
        appearance: 'Apar√™ncia',
        language: 'Idioma e Regi√£o',
        name: 'Nome',
        email: 'Email',
        phone: 'Telefone',
        bio: 'Biografia',
        company: 'Empresa',
        website: 'Site',
        location: 'Localiza√ß√£o',
        timezone: 'Fuso Hor√°rio',
        darkMode: 'Modo Escuro',
        compactMode: 'Modo Compacto',
        animations: 'Anima√ß√µes',
        fontSize: 'Tamanho da Fonte',
        colorScheme: 'Esquema de Cores',
        dateFormat: 'Formato de Data',
        timeFormat: 'Formato de Hora',
        currency: 'Moeda',
        push: 'Notifica√ß√µes Push',
        weeklyReport: 'Relat√≥rio Semanal',
        productUpdates: 'Atualiza√ß√µes de Produto',
        securityAlerts: 'Alertas de Seguran√ßa',
        totalRevenue: 'Receita Total',
        totalOrders: 'Pedidos Totais',
        activeUsers: 'Usu√°rios Ativos',
        totalProducts: 'Produtos Totais',
        stats: 'Estat√≠sticas',
      },
      'ja-JP': {
        exportDate: '„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊó•',
        generatedBy: '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Ç∑„Çπ„ÉÜ„É†„ÅßÁîüÊàê',
        totalRecords: 'Á∑è„É¨„Ç≥„Éº„ÉâÊï∞',
        summary: 'Ê¶ÇË¶Å',
        page: '„Éö„Éº„Ç∏',
        profile: '„Éó„É≠„Éï„Ç£„Éº„É´Ë®≠ÂÆö',
        notifications: 'ÈÄöÁü•Ë®≠ÂÆö',
        theme: '„ÉÜ„Éº„Éû„Å®Â§ñË¶≥',
        appearance: 'Â§ñË¶≥',
        language: 'Ë®ÄË™û„Å®Âú∞Âüü',
        name: 'ÂêçÂâç',
        email: '„É°„Éº„É´',
        phone: 'ÈõªË©±',
        bio: 'Ëá™Â∑±Á¥π‰ªã',
        company: '‰ºöÁ§æ',
        website: '„Ç¶„Çß„Éñ„Çµ„Ç§„Éà',
        location: 'Â†¥ÊâÄ',
        timezone: '„Çø„Ç§„É†„Çæ„Éº„É≥',
        darkMode: '„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ',
        compactMode: '„Ç≥„É≥„Éë„ÇØ„Éà„É¢„Éº„Éâ',
        animations: '„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥',
        fontSize: '„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫',
        colorScheme: '„Ç´„É©„Éº„Çπ„Ç≠„Éº„É†',
        dateFormat: 'Êó•‰ªòÂΩ¢Âºè',
        timeFormat: 'ÊôÇÂàªÂΩ¢Âºè',
        currency: 'ÈÄöË≤®',
        push: '„Éó„ÉÉ„Ç∑„É•ÈÄöÁü•',
        weeklyReport: 'ÈÄ±Ê¨°„É¨„Éù„Éº„Éà',
        productUpdates: 'Ë£ΩÂìÅ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà',
        securityAlerts: '„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç¢„É©„Éº„Éà',
        totalRevenue: 'Á∑èÂèéÁõä',
        totalOrders: 'Á∑èÊ≥®ÊñáÊï∞',
        activeUsers: '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É¶„Éº„Ç∂„Éº',
        totalProducts: 'Á∑èË£ΩÂìÅÊï∞',
        stats: 'Áµ±Ë®à',
        title: '„Çø„Ç§„Éà„É´',
        value: 'ÂÄ§',
        change: 'Â§âÊõ¥',
      },
      'zh-CN': {
        exportDate: 'ÂØºÂá∫Êó•Êúü',
        generatedBy: 'Áî±‰ª™Ë°®ÊùøÁ≥ªÁªüÁîüÊàê',
        totalRecords: 'ÊÄªËÆ∞ÂΩïÊï∞',
        summary: 'ÊëòË¶Å',
        page: 'È°µ',
        profile: '‰∏™‰∫∫ËµÑÊñôËÆæÁΩÆ',
        notifications: 'ÈÄöÁü•ÂÅèÂ•Ω',
        theme: '‰∏ªÈ¢òÂíåÂ§ñËßÇ',
        appearance: 'Â§ñËßÇ',
        language: 'ËØ≠Ë®ÄÂíåÂú∞Âå∫',
        name: 'ÂêçÁß∞',
        email: 'ÁîµÂ≠êÈÇÆ‰ª∂',
        phone: 'ÁîµËØù',
        bio: 'ÁÆÄ‰ªã',
        company: 'ÂÖ¨Âè∏',
        website: 'ÁΩëÁ´ô',
        location: '‰ΩçÁΩÆ',
        timezone: 'Êó∂Âå∫',
        darkMode: 'Ê∑±Ëâ≤Ê®°Âºè',
        compactMode: 'Á¥ßÂáëÊ®°Âºè',
        animations: 'Âä®Áîª',
        fontSize: 'Â≠ó‰ΩìÂ§ßÂ∞è',
        colorScheme: 'ÈÖçËâ≤ÊñπÊ°à',
        dateFormat: 'Êó•ÊúüÊ†ºÂºè',
        timeFormat: 'Êó∂Èó¥Ê†ºÂºè',
        currency: 'Ë¥ßÂ∏Å',
        push: 'Êé®ÈÄÅÈÄöÁü•',
        weeklyReport: 'ÊØèÂë®Êä•Âëä',
        productUpdates: '‰∫ßÂìÅÊõ¥Êñ∞',
        securityAlerts: 'ÂÆâÂÖ®Ë≠¶Êä•',
        totalRevenue: 'ÊÄªÊî∂ÂÖ•',
        totalOrders: 'ÊÄªËÆ¢Âçï',
        activeUsers: 'Ê¥ªË∑ÉÁî®Êà∑',
        totalProducts: 'ÊÄª‰∫ßÂìÅ',
        stats: 'ÁªüËÆ°',
      },
    };
    
    const langCode = language.startsWith('en') ? 'en-US' :
                     language.startsWith('es') ? 'es-ES' :
                     language.startsWith('fr') ? 'fr-FR' :
                     language.startsWith('de') ? 'de-DE' :
                     language.startsWith('pt') ? 'pt-BR' :
                     language.startsWith('ja') ? 'ja-JP' :
                     language.startsWith('zh') ? 'zh-CN' : 'en-US';
    
    return texts[langCode][key] || key;
  };

  const getSectionEmoji = (key: string): string => {
    const emojiMap: Record<string, string> = {
      profile: 'üë§',
      notifications: 'üîî',
      theme: 'üé®',
      appearance: '‚ú®',
      language: 'üåê',
    };
    return emojiMap[key] || 'üìã';
  };

  const getFieldEmoji = (key: string): string => {
    const emojiMap: Record<string, string> = {
      name: 'üë§',
      email: 'üìß',
      phone: 'üì±',
      bio: 'üìù',
      company: 'üè¢',
      website: 'üåê',
      location: 'üìç',
      timezone: 'üåç',
      darkMode: 'üåô',
      compactMode: 'üìê',
      animations: '‚ú®',
      fontSize: 'üî§',
      colorScheme: 'üé®',
      dateFormat: 'üìÖ',
      timeFormat: '‚è∞',
      currency: 'üí∞',
      push: 'üì≤',
      weeklyReport: 'üìä',
      productUpdates: 'üÜï',
      securityAlerts: 'üîí',
    };
    return emojiMap[key] || '‚ñ´Ô∏è';
  };

  const translateHeader = (key: string): string => {
    const translations: Record<string, Record<string, string>> = {
      'en-US': {
        id: 'ID',
        name: 'Name',
        category: 'Category',
        price: 'Price',
        stock: 'Stock',
        status: 'Status',
        sales: 'Sales',
        email: 'Email',
        phone: 'Phone',
        role: 'Role',
        fullName: 'Full Name',
        contact: 'Contact',
      },
      'es-ES': {
        id: 'ID',
        name: 'Nombre',
        category: 'Categor√≠a',
        price: 'Precio',
        stock: 'Existencias',
        status: 'Estado',
        sales: 'Ventas',
        email: 'Correo',
        phone: 'Tel√©fono',
        role: 'Rol',
        fullName: 'Nombre Completo',
        contact: 'Contacto',
      },
      'fr-FR': {
        id: 'ID',
        name: 'Nom',
        category: 'Cat√©gorie',
        price: 'Prix',
        stock: 'Stock',
        status: 'Statut',
        sales: 'Ventes',
        email: 'Email',
        phone: 'T√©l√©phone',
        role: 'R√¥le',
        fullName: 'Nom Complet',
        contact: 'Contact',
      },
      'de-DE': {
        id: 'ID',
        name: 'Name',
        category: 'Kategorie',
        price: 'Preis',
        stock: 'Lagerbestand',
        status: 'Status',
        sales: 'Verk√§ufe',
        email: 'E-Mail',
        phone: 'Telefon',
        role: 'Rolle',
        fullName: 'Vollst√§ndiger Name',
        contact: 'Kontakt',
      },
      'pt-BR': {
        id: 'ID',
        name: 'Nome',
        category: 'Categoria',
        price: 'Pre√ßo',
        stock: 'Estoque',
        status: 'Status',
        sales: 'Vendas',
        email: 'Email',
        phone: 'Telefone',
        role: 'Fun√ß√£o',
        fullName: 'Nome Completo',
        contact: 'Contato',
      },
      'ja-JP': {
        id: 'ID',
        name: 'ÂêçÂâç',
        category: '„Ç´„ÉÜ„Ç¥„É™',
        price: '‰æ°Ê†º',
        stock: 'Âú®Â∫´',
        status: '„Çπ„ÉÜ„Éº„Çø„Çπ',
        sales: 'Â£≤‰∏ä',
        email: '„É°„Éº„É´',
        phone: 'ÈõªË©±',
        role: 'ÂΩπÂâ≤',
        fullName: '„Éï„É´„Éç„Éº„É†',
        contact: 'ÈÄ£Áµ°ÂÖà',
      },
      'zh-CN': {
        id: 'ID',
        name: 'ÂêçÁß∞',
        category: 'Á±ªÂà´',
        price: '‰ª∑Ê†º',
        stock: 'Â∫ìÂ≠ò',
        status: 'Áä∂ÊÄÅ',
        sales: 'ÈîÄÂîÆ',
        email: 'ÁîµÂ≠êÈÇÆ‰ª∂',
        phone: 'ÁîµËØù',
        role: 'ËßíËâ≤',
        fullName: 'ÂÖ®Âêç',
        contact: 'ËÅîÁ≥ªÊñπÂºè',
      },
    };
    
    const langCode = language.startsWith('en') ? 'en-US' :
                     language.startsWith('es') ? 'es-ES' :
                     language.startsWith('fr') ? 'fr-FR' :
                     language.startsWith('de') ? 'de-DE' :
                     language.startsWith('pt') ? 'pt-BR' :
                     language.startsWith('ja') ? 'ja-JP' :
                     language.startsWith('zh') ? 'zh-CN' : 'en-US';
    
    return translations[langCode][key] || key.charAt(0).toUpperCase() + key.slice(1);
  };

  let htmlContent = `
<!DOCTYPE html>
<html lang="${language}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${title}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    @media print {
      body { margin: 0; padding: 40px; }
      .page-break { page-break-after: always; }
      .no-print { display: none; }
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      padding: 60px 80px;
      max-width: 1200px;
      margin: 0 auto;
      background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
      color: #1a202c;
      line-height: 1.8;
    }
    
    .document-wrapper {
      background: white;
      padding: 60px;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
    }
    
    .header {
      text-align: center;
      margin-bottom: 60px;
      padding-bottom: 40px;
      border-bottom: 1px solid #e2e8f0;
      position: relative;
    }
    
    .header::before {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      border-radius: 2px;
    }
    
    .header h1 {
      color: #1a202c;
      font-size: 42px;
      margin: 0 0 16px 0;
      font-weight: 700;
      letter-spacing: -1px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .header .subtitle {
      color: #64748b;
      font-size: 15px;
      margin: 12px 0;
      font-weight: 400;
      letter-spacing: 0.3px;
    }
    
    .meta-info {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 24px;
      flex-wrap: wrap;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #475569;
      font-size: 14px;
    }
    
    .summary-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 32px 40px;
      border-radius: 16px;
      margin: 40px 0;
      box-shadow: 0 10px 40px rgba(102, 126, 234, 0.25);
    }
    
    .summary-card p {
      margin: 12px 0;
      font-size: 16px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .summary-card strong {
      font-weight: 600;
      opacity: 0.95;
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin: 40px 0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border-radius: 12px;
      overflow: hidden;
    }
    
    th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 18px 20px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    
    th:first-child {
      border-top-left-radius: 12px;
    }
    
    th:last-child {
      border-top-right-radius: 12px;
    }
    
    td {
      padding: 18px 20px;
      border-bottom: 1px solid #f1f5f9;
      font-size: 15px;
      color: #334155;
    }
    
    tr:nth-child(even) {
      background-color: #f8fafc;
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    tr:last-child td:first-child {
      border-bottom-left-radius: 12px;
    }
    
    tr:last-child td:last-child {
      border-bottom-right-radius: 12px;
    }
    
    tbody tr {
      transition: all 0.2s ease;
    }
    
    tbody tr:hover {
      background-color: #f1f5f9;
      transform: translateY(-1px);
    }
    
    .section-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin: 40px 0;
    }
    
    .section-card {
      background: #ffffff;
      padding: 32px;
      border-radius: 16px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
      transition: all 0.3s ease;
    }
    
    .section-card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
    }
    
    .section-card h2 {
      color: #1e293b;
      margin: 0 0 24px 0;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 16px;
      border-bottom: 2px solid #f1f5f9;
    }
    
    .info-grid {
      display: grid;
      gap: 16px;
    }
    
    .info-item {
      padding: 16px 20px;
      background: #f8fafc;
      border-radius: 10px;
      border-left: 3px solid #667eea;
      transition: all 0.2s ease;
    }
    
    .info-item:hover {
      background: #f1f5f9;
      border-left-color: #764ba2;
    }
    
    .info-item strong {
      color: #64748b;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      font-weight: 600;
    }
    
    .info-item span {
      color: #1e293b;
      font-size: 16px;
      font-weight: 500;
      display: block;
    }
    
    .footer {
      margin-top: 80px;
      padding-top: 32px;
      border-top: 1px solid #e2e8f0;
      text-align: center;
      color: #64748b;
      font-size: 14px;
    }
    
    .footer p {
      margin: 8px 0;
    }
    
    .badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      background: #dbeafe;
      color: #1e40af;
    }
    
    .badge-success {
      background: #dcfce7;
      color: #166534;
    }
    
    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }
    
    .badge-info {
      background: #e0e7ff;
      color: #3730a3;
    }
    
    @media (max-width: 768px) {
      body {
        padding: 30px 20px;
      }
      
      .document-wrapper {
        padding: 30px 20px;
        border-radius: 16px;
      }
      
      .header h1 {
        font-size: 32px;
      }
      
      .section-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="document-wrapper">
    <div class="header">
      <h1>üìÑ ${title}</h1>
      <div class="meta-info">
        <div class="meta-item">
          <span>üìÖ</span>
          <span>${getLocalizedText('exportDate')}: ${new Date().toLocaleString(language, { 
            dateStyle: 'full', 
            timeStyle: 'short' 
          })}</span>
        </div>
      </div>
    </div>
`;

  if (Array.isArray(data)) {
    if (data.length > 0) {
      htmlContent += `
  <div class="summary-card">
    <p><strong>üìä ${getLocalizedText('totalRecords')}:</strong> ${data.length}</p>
  </div>
`;
      
      const headers = Object.keys(data[0]).filter(h => h !== 'image');
      htmlContent += `
  <table>
    <thead>
      <tr>
        ${headers.map(h => `<th>${translateHeader(h)}</th>`).join('')}
      </tr>
    </thead>
    <tbody>
`;
      
      data.forEach(row => {
        htmlContent += `
      <tr>
        ${headers.map(h => {
          let value = row[h];
          if (h === 'status') {
            const badgeClass = value === 'active' ? 'badge-success' : 'badge-warning';
            return `<td><span class="badge ${badgeClass}">${value}</span></td>`;
          }
          if (h === 'price') {
            return `<td><strong>$${parseFloat(value).toFixed(2)}</strong></td>`;
          }
          return `<td>${value ?? ''}</td>`;
        }).join('')}
      </tr>
`;
      });
      
      htmlContent += `
    </tbody>
  </table>
`;
    }
  } else {
    // Show summary stats if they exist
    const hasBasicStats = data.totalRevenue || data.totalOrders || data.activeUsers || data.totalProducts;
    if (hasBasicStats) {
      htmlContent += `
  <div class="summary-card">
    ${data.totalRevenue ? `<p><strong>üí∞ ${getLocalizedText('totalRevenue')}:</strong> ${data.totalRevenue}</p>` : ''}
    ${data.totalOrders ? `<p><strong>üõí ${getLocalizedText('totalOrders')}:</strong> ${data.totalOrders}</p>` : ''}
    ${data.activeUsers ? `<p><strong>üë• ${getLocalizedText('activeUsers')}:</strong> ${data.activeUsers}</p>` : ''}
    ${data.totalProducts ? `<p><strong>üì¶ ${getLocalizedText('totalProducts')}:</strong> ${data.totalProducts}</p>` : ''}
  </div>
`;
    }

    // Show stats array if it exists
    if (Array.isArray(data.stats) && data.stats.length > 0) {
      htmlContent += `
  <div class="section-card">
    <h2>üìä ${getLocalizedText('stats')}</h2>
    <div class="info-grid">`;
      data.stats.forEach((stat: any) => {
        htmlContent += `
      <div class="info-item">
        <strong>${stat.title}</strong>
        <span>${stat.value} ${stat.change ? `<span class="badge badge-info">${stat.change}</span>` : ''}</span>
      </div>`;
      });
      htmlContent += `
    </div>
  </div>
`;
    }

    htmlContent += '<div class="section-grid">';
    Object.entries(data).forEach(([key, value]) => {
      // Skip stats array and basic stats as we already showed them
      if (key === 'stats' || key === 'totalRevenue' || key === 'totalOrders' || key === 'activeUsers' || key === 'totalProducts') {
        return;
      }

      if (typeof value === 'object' && !Array.isArray(value) && value !== null && !key.includes('Date')) {
        const sectionEmoji = getSectionEmoji(key);
        const sectionTitle = getLocalizedText(key);
        htmlContent += `<div class="section-card"><h2>${sectionEmoji} ${sectionTitle}</h2><div class="info-grid">`;
        Object.entries(value as object).forEach(([k, v]) => {
          const fieldEmoji = getFieldEmoji(k);
          const translatedKey = getLocalizedText(k);
          const displayValue = typeof v === 'boolean' ? (v ? '‚úÖ ' + (
            language.startsWith('es') ? 'S√≠' :
            language.startsWith('fr') ? 'Oui' :
            language.startsWith('de') ? 'Ja' :
            language.startsWith('pt') ? 'Sim' :
            language.startsWith('ja') ? '„ÅØ„ÅÑ' :
            language.startsWith('zh') ? 'ÊòØ' : 'Yes'
          ) : '‚ùå No') : v;
          htmlContent += `
          <div class="info-item">
            <strong>${fieldEmoji} ${translatedKey}</strong>
            <span>${displayValue}</span>
          </div>`;
        });
        htmlContent += '</div></div>';
      } else if (!key.includes('Date')) {
        const fieldEmoji = getFieldEmoji(key);
        const translatedKey = getLocalizedText(key);
        const displayValue = typeof value === 'boolean' ? (value ? '‚úÖ ' + (
          language.startsWith('es') ? 'S√≠' :
          language.startsWith('fr') ? 'Oui' :
          language.startsWith('de') ? 'Ja' :
          language.startsWith('pt') ? 'Sim' :
          language.startsWith('ja') ? '„ÅØ„ÅÑ' :
          language.startsWith('zh') ? 'ÊòØ' : 'Yes'
        ) : '‚ùå No') : value;
        htmlContent += `
        <div class="section-card">
          <div class="info-item">
            <strong>${fieldEmoji} ${translatedKey}</strong>
            <span>${displayValue}</span>
          </div>
        </div>`;
      }
    });
    htmlContent += '</div>';
  }

  htmlContent += `
    <div class="footer">
      <p><strong>‚öôÔ∏è ${getLocalizedText('generatedBy')}</strong></p>
      <p>üìÜ ${new Date().toLocaleDateString(language, { dateStyle: 'full' })}</p>
    </div>
  </div>
</body>
</html>
`;
  
  const blob = new Blob([htmlContent], { type: 'text/html' });
  downloadBlob(blob, `${filename}.html`);
}

function downloadBlob(blob: Blob, filename: string) {
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

export function createExportMenu(
  data: any,
  filename: string,
  title: string,
  language: string = 'en-US',
  onExport?: (format: string) => void
) {
  return {
    csv: () => {
      if (Array.isArray(data)) {
        exportToCSV(data, filename, language);
      } else {
        exportToCSV([data], filename, language);
      }
      onExport?.('CSV');
    },
    txt: () => {
      exportToText(data, filename, title, language);
      onExport?.('Text');
    },
    pdf: () => {
      exportToPDF(data, filename, title, language);
      onExport?.('PDF');
    },
  };
}
